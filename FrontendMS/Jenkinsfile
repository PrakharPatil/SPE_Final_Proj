pipeline {
  agent any
  triggers { pollSCM('H/5 * * * *') }
  options { skipDefaultCheckout() }
  stages {
    stage('Checkout') {
      steps {
        checkout([$class: 'GitSCM',
          branches: [[name: '*/main']],
          extensions: [[ $class: 'CloneOption', shallow: true, depth: 2, noTags: false ]],
          userRemoteConfigs: [[url: 'https://github.com/PrakharPatil/SPE_Final_Proj.git', credentialsId: '...']]
        ])
      }
    }
    stage('Detect Changes') {
      steps {
        script {
          def changes = []
          for (changeSet in currentBuild.changeSets) {
            for (entry in changeSet.items) {
              for (file in entry.affectedFiles) {
                changes << file.path
              }
            }
          }
          echo "Changed files: ${changes}"
          if (!changes.any{ it.startsWith('FrontendMS/') }) {
            echo 'No FrontendMS changes, skipping build'
            currentBuild.result = 'NOT_BUILT'
            return
          }
        }
      }
    }
    stage('Build Transformer') {
      steps {
        echo 'Building FrontendMS...'
        // (Your build steps go here)
      }
    }
  }
}
